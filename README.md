# HMAC-java

HTTP-сервер для генерации и проверки HMAC-подписей сообщений.

## Содержание

- [Требования к окружению и установка](#требования-к-окружению-и-установка)
- [Генерация секрета](#генерация-секрета)
- [Формат config.json](#формат-configjson)
- [Запуск сервера](#запуск-сервера)
- [Примеры curl](#примеры-curl)
- [Ограничения учебной реализации](#ограничения-учебной-реализации)

## Требования к окружению и установка

### Требования

- **Java 21** или выше
- **Maven/Gradle не требуется** — проект использует прямую компиляцию через `javac`
- Все необходимые зависимости находятся в директории `lib/`

### Установка

1. Клонируйте репозиторий или распакуйте архив проекта
2. Убедитесь, что все JAR-файлы находятся в директории `lib/`
3. Проверьте наличие файла `config.json` в корне проекта

## Генерация секрета

Для генерации и управления секретным ключом используется утилита `SecretManagerCLI`, доступная через скрипт `secret-manager-cli.sh`.

### Генерация нового случайного секрета

```bash
./secret-manager-cli.sh generate config.json
```

Эта команда:
- Генерирует 32 случайных байта (256 бит) для алгоритма HmacSHA256
- Кодирует их в Base64
- Автоматически обновляет поле `secret` в файле `config.json`

### Установка конкретного секрета

```bash
./secret-manager-cli.sh set config.json "YOUR_BASE64_ENCODED_SECRET"
```

### Справка

```bash
./secret-manager-cli.sh help
```

**Важно:** После изменения секрета в `config.json` необходимо:
- **При локальном запуске:** перезапустить сервер
- **При запуске через Docker:** пересобрать контейнер

## Формат config.json

Файл конфигурации должен содержать следующие поля:
### Пример валидной конфигурации
```json
{
  "hmacAlg": "HmacSHA256",
  "secret": "SUPERSECRETKEYBASE64",
  "listenPort": 8080,
  "maxMsgSizeBytes": 1048576
}
```

### Описание полей

- **`hmacAlg`** (обязательное) — алгоритм HMAC. Поддерживается `HmacSHA256`
- **`secret`** (обязательное) — секретный ключ в формате Base64. Должен быть сгенерирован через `secret-manager-cli.sh`
- **`listenPort`** (обязательное) — порт для прослушивания HTTP-запросов (1-65535)
- **`maxMsgSizeBytes`** (обязательное) — максимальный размер сообщения в байтах (должен быть положительным числом)


## Запуск сервера

### Локальный запуск

1. Скомпилируйте проект:
```bash
find src -name "*.java" > sources.txt
javac -cp "lib/*" -d out @sources.txt
rm sources.txt
```

2. Запустите сервер:
```bash
java -cp "lib/*:out" \
  -Dlogback.configurationFile=resources/logback.xml \
  io.github.martinez1337.hmac.api.ServerHMAC
```

Сервер будет доступен по адресу `http://localhost:8080`

### Запуск через Docker

1. Соберите Docker-образ:
```bash
docker build -t hmac-java .
```

2. Запустите контейнер:
```bash
docker run -p 8080:8080 hmac-java
```

Сервер будет доступен по адресу `http://localhost:8080`

**Примечание:** При изменении `config.json` необходимо пересобрать образ

## Примеры curl

### Подписание сообщения

Запрос на генерацию HMAC-подписи для сообщения:

```bash
curl -X POST http://localhost:8080/sign \
  -H "Content-Type: application/json" \
  -d '{"msg": "Hello, World!"}'
```

**Ответ:**
```json
{
  "signature": "base64-encoded-hmac-signature"
}
```

### Проверка подписи

Запрос на проверку HMAC-подписи:

```bash
curl -X POST http://localhost:8080/verify \
  -H "Content-Type: application/json" \
  -d '{
    "msg": "Hello, World!",
    "signature": "base64-encoded-hmac-signature"
  }'
```

**Ответ при успешной проверке:**
```json
{
  "ok": true
}
```

**Ответ при неуспешной проверке:**
```json
{
  "ok": false
}
```

## Ограничения учебной реализации

Данная реализация является учебной и имеет следующие ограничения:

### HMAC ≠ асимметричная электронная подпись

- HMAC использует симметричный ключ (один и тот же ключ для подписания и проверки)
- Это не асимметричная криптография (RSA, ECDSA), где используются пары ключей (приватный/публичный)
- HMAC подходит для проверки целостности и аутентификации, но не обеспечивает non-repudiation (неотказуемость)

### Нет многоключевой валидации

- Сервер использует только один активный секретный ключ
- Нет поддержки нескольких ключей одновременно (key rotation без простоя)
- Нет возможности проверять подписи, созданные старыми ключами после ротации

### Простая ротация секрета

- Ротация секрета требует перезапуска сервера (локально) или пересборки контейнера (Docker)
- Нет автоматической ротации ключей
- Нет поддержки graceful rotation (плавной смены ключей без прерывания работы)
- После ротации все старые подписи становятся невалидными

### Дополнительные ограничения

- Поддерживается только алгоритм `HmacSHA256`
- Максимальный размер сообщения ограничен параметром `maxMsgSizeBytes` в конфигурации
- Нет поддержки аутентификации клиентов (любой может использовать API)
- Нет rate limiting или защиты от злоупотреблений
- Нет персистентного хранения подписей или истории операций